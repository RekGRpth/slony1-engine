%META:TOPICINFO{author="guest" date="1099542268" format="1.0" version="1.2"}%
%META:TOPICPARENT{name="SlonyFAQ"}%
---++ Some nodes start consistently falling behind

I have been running Slony-I on a node for a while, and am seeing
system performance suffering.

I'm seeing long running queries of the form:
<verbatim>
	fetch 100 from LOG;
</verbatim>

This is characteristic of pg_listener (which is the table containing
NOTIFY data) having plenty of dead tuples in it.  That makes NOTIFY
events take a long time, and causes the affected node to gradually
fall further and further behind.

You quite likely need to do a VACUUM FULL on pg_listener, to vigorously clean it out, and need to vacuum pg_listener really frequently.  Once every five minutes would likely be AOK.

Slon daemons already vacuum a bunch of tables, and cleanup_thread.c contains a list of tables that are frequently vacuumed automatically.  In Slony-I 1.0.2, pg_listener is not included.  In 1.0.5 and later, it is regularly vacuumed, so this should cease to be a direct issue.

There is, however, still a scenario where this will still "bite."  Vacuums cannot delete tuples that were made "obsolete" at any time after the start time of the eldest transaction that is still open.  Long running transactions will cause trouble, and should be avoided, even on "slave" nodes.


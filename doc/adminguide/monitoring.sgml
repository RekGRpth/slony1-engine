<!-- $Id: monitoring.sgml,v 1.10 2005-02-02 19:41:54 cbbrowne Exp $ -->
<sect1 id="monitoring">
<title>Monitoring</title>

<para>Here are some of things that you may find in your
<productname>Slony-I</productname> logs, and explanations of what they mean.</para>

<sect2><title>CONFIG notices</title>

<para>These entries are pretty straightforward. They are informative
messages about your configuration.</para>

<para>Here are some typical entries that you will probably run into in
your logs:

<screen>
CONFIG main: local node id = 1
CONFIG main: loading current cluster configuration
CONFIG storeNode: no_id=3 no_comment='Node 3'
CONFIG storePath: pa_server=5 pa_client=1 pa_conninfo="host=127.0.0.1 dbname=foo user=postgres port=6132" pa_connretry=10
CONFIG storeListen: li_origin=3 li_receiver=1 li_provider=3
CONFIG storeSet: set_id=1 set_origin=1 set_comment='Set 1'
CONFIG main: configuration complete - starting threads
</screen></para></sect2>

<sect2><title>DEBUG Notices</title>

<para>Debug notices are always prefaced by the name of the thread that
the notice originates from. You will see messages from the following
threads:

<variablelist>
<varlistentry><term>localListenThread</term> 

<listitem><para> This is the local thread that listens for events on
the local node.</para></listitem></varlistentry>

<varlistentry><term>remoteWorkerThread-X</term> 

<listitem><para> The thread processing remote events.  You can expect
to see one of these for each node that this node communicates
with.</para></listitem></varlistentry>

<varlistentry><term>remoteListenThread-X</term>

<listitem><para>Listens for events on a remote node database.  You may
expect to see one of these for each node in the
cluster.</para></listitem></varlistentry>

<varlistentry><term>cleanupThread</term> <listitem><para> Takes care
of things like vacuuming, cleaning out the confirm and event tables,
and deleting logs.</para></listitem></varlistentry>

<varlistentry><term>syncThread</term> <listitem><para> Generates sync
events.</para></listitem></varlistentry>

</variablelist>
</para>
<para> WriteMe: I can't decide the format for the rest of this. I
think maybe there should be a "how it works" page, explaining more
about how the threads work, what to expect in the logs after you run a
</para>
</sect2>

<sect2 id="testslonystate"> <title> test_slony_state.pl </title>

<para> This script is in preliminary stages, and may be used to do
some analysis of the state of a <productname>Slony-I</productname>
cluster.</para>

<para> You specify arguments including <option>database</option>,
<option>host</option>, <option>user</option>,
<option>cluster</option>, <option>password</option>, and
<option>port</option> to connect to any of the nodes on a cluster.</para>

<para> The script then rummages through <envar>sl_path</envar> to find
all of the nodes in the cluster, and the DSNs to allow it to, in turn,
connect to each of them.</para>

<para> For each node, the script examines the state of things,
including such things as:

<itemizedlist>
<listitem><para> Checking <envar> sl_listen </envar> for some
<quote>analytically determinable</quote> problems.  It lists paths
that are not covered.  

<listitem><para> Providing a summary of events by origin node

<para> If a node hasn't submitted any events in a while, that likely suggests a problem.

<listitem><para> Summarizes the <quote>aging</quote> of table <envar>sl_confirm</envar>

<para> If one or another of the nodes in the cluster hasn't reported
back recently, that tends to lead to cleanups of tables like <envar>
sl_log_1 </envar> and <envar> sl_seqlog </envar> not taking place.

<listitem><para> Summarizes what transactions have been running for a
long time

<para> This only works properly if the statistics collector is
configured to collect command strings, as controlled by the option
<option> stats_command_string = true </option> in <filename>
postgresql.conf </filename>.

<para> If you have broken applications that hold connections open,
this will find them.

<para> If you have broken applications that hold connections open,
that has several unsalutory effects as <link
linkend="longtxnsareevil"> described in the FAQ</link>.

</itemizedlist>

<para> The script does not yet do much in the way of diagnosis work;
it should be enhanced to be able to, based on some parameterization,
notify someone of those problems it encounters.

</sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode:sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"./reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:("/usr/lib/sgml/catalog")
sgml-local-ecat-files:nil
End:
-->

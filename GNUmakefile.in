# ----------
# Makefile for Slony-I
#
#	Copyright (c) 2003-2004, PostgreSQL Global Development Group
#	Author: Jan Wieck, Afilias USA INC.
#
# $Id: GNUmakefile.in,v 1.23 2005-06-08 18:11:03 devrim Exp $
# ----------

top_builddir = .
include $(top_builddir)/Makefile.global
TAR = tar
GZIP = gzip --best

DEFAULTBUILDS=src tools

ifeq (@with_docs@, yes)
DEFAULTBUILDS+=" doc"
endif

DISTFILES = aclocal.m4 \
  config.h.in \
  configure \
  COPYRIGHT \
  README \
  UPGRADING \
  HISTORY-1.1 \
  INSTALL \
  SAMPLE \
  Makefile \
  Makefile.global.in \
  GNUmakefile.in \
  @PACKAGE_NAME@.spec \
  @PACKAGE_NAME@.spec.in \
  $(wildcard config/*) \
  $(wildcard src/*) \
  $(wildcard doc/*) \
  $(wildcard share/*) \
  $(wildcard makefiles/*)


all:
	@for subdir in $(DEFAULTBUILDS) ; do \
	  $(MAKE) -C $$subdir $@ || exit; \
    done && \
	echo "All of Slony-I is successfully made. Ready to install"

install	installdirs:
	@for subdir in $(DEFAULTBUILDS) ; do \
	  $(MAKE) -C $$subdir $@ || exit; \
    done && \
	echo "All of Slony-I is successfully installed"

clean:
	@for subdir in $(DEFAULTBUILDS) ; do \
	  $(MAKE) -C $$subdir $@ ; \
    done ;\
      rm -f postgres.imp

distclean: clean
	rm -f Makefile.global Makefile.port
	rm -f GNUmakefile
	rm -f config.log config.status config.h
	rm -f @PACKAGE_NAME@.spec
	rm -f @PACKAGE_NAME@-@PACKAGE_VERSION@.tar.gz
	rm -f postgres.imp
	rm -rf autom4te.cache

maintainer-clean: distclean
	rm -rf configure autom4te.cache

dist: distdir
	-chmod -R a+r $(distdir)
	$(TAR) --exclude */CVS -chof - @PACKAGE_NAME@-@PACKAGE_VERSION@ | $(GZIP) -c > @PACKAGE_NAME@-@PACKAGE_VERSION@.tar.gz
	-rm -rf $(distdir)

distdir: $(DISTFILES)
	-rm -rf $(distdir)
	mkdir $(distdir)
	mkdir $(distdir)/config
	mkdir $(distdir)/src
	mkdir $(distdir)/doc
	mkdir $(distdir)/share
	mkdir $(distdir)/makefiles
	-chmod -R 777 $(distdir)
	for file in $(DISTFILES) ; do \
      cp -r $$file $(distdir)/$$file ; \
    done
	for subdir in src doc tools ; do \
	  $(MAKE) -C $$subdir distdir ; \
    done

rpm: dist
	rpmbuild -ta @PACKAGE_NAME@-@PACKAGE_VERSION@.tar.gz
